name: Check Links

on:
  pull_request:
    branches: 
      - master
      - main
  workflow_dispatch:

jobs:

  generate-matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
    steps:
      - uses: actions/checkout@v3
      - id: set-matrix
        run: echo "::set-output name=matrix::$(find "$(pwd)" -type f -iname \*.md | jq -R -s -c 'split("\n")[:-1]')"

  markdown-link-check:
    runs-on: ubuntu-latest
    steps:

    - name: Install markdown-link-check
      run: sudo npm install -g markdown-link-check

    - uses: actions/checkout@v3

    - name: Run markdown-link-check against *.md files
      run: find "$(pwd)" -iname \*.md -print0 | xargs -0 -n1 markdown-link-check --config "$(pwd)/.markdown-link-check.json" --quiet
